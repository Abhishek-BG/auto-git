name: Auto commit for previous year

on:
  push:
    branches:
      - main

jobs:
  auto_commit:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          persist-credentials: true
          fetch-depth: 0

      - name: Setup Git Config
        run: |
          git config --global user.email "abhigowda0190@gmail.com"
          git config --global user.name "Abhishek-BG"

      - name: Generate Commits for the Past Year
        run: |
          # Array of commit messages
          arr=(
            "Updates"
            "New Updates"
            "Fixtures"
            "Commit"
            "Updated client folder"
            "New Commit"
            "Model"
            "Recent Updates"
            "Updated index"
            "Changes to source"
            "Refactor code"
            "Fix bugs"
            "Improve performance"
            "Update dependencies"
            "Add new feature"
            "Optimize code"
            "Code cleanup"
            "Update documentation"
            "Enhance UI"
            "Bug fixes and improvements"
            "Update README"
            "Improve UX"
            "Fix typos"
            "Update configs"
          )

          # Number of days to randomly pick
          days_to_commit=200

          # Create an array of all dates in the past year
          all_dates=()
          for i in {365..1}; do
            all_dates+=("$(date -d "$i days ago" '+%Y-%m-%d')")
          done

          # Shuffle and pick random days
          random_days=($(shuf -e "${all_dates[@]}" -n "$days_to_commit"))

          # Iterate over each random day and make a random number of commits
          for day in "${random_days[@]}"; do
            # Generate random number of commits for this day (0 to 17)
            num_commits=$((RANDOM % 18))
            
            for ((j = 0; j < num_commits; j++)); do
              commit_date=$(date -d "$day" '+%Y-%m-%dT%H:%M:%SZ')
              rand=$((RANDOM % ${#arr[@]}))
              commit_message="${arr[$rand]} - $commit_date"
              
              # Create a file with the commit date
              echo "$commit_date" > LAST_UPDATED

              # Add, commit, and set the commit date
              git add LAST_UPDATED
              GIT_COMMITTER_DATE="$commit_date" git commit -m "$commit_message" --date="$commit_date"
            done
          done

      - name: Verify Commits
        run: git log --oneline

      - name: Push Changes
        env:
          AUTO_COMMIT: ${{ secrets.AUTO_COMMIT }}
        run: |
          git remote set-url origin https://x-access-token:${AUTO_COMMIT}@github.com/${{ github.repository }}.git
          git push origin main --force
